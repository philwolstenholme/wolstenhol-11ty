<!DOCTYPE html>
<html lang="{{ meta.lang }}" class="no-js overflow-x-hidden overflow-y-scroll antialiased">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {%- if seo.title -%}
      {{ seo.title }}
      {%- else -%}
      {{ title }} | {{ meta.title }}
      {%- endif -%}
    </title>
    <link rel="stylesheet" href="/assets/styles/main.css" />
    <meta name="view-transition" content="same-origin" />
    {% include "meta.njk" %}
    <style>
      /*
       * https://infrequently.org/2020/12/resize-resilient-deferred-rendering/
       */
      body main section + section {
        content-visibility: auto;
        contain-intrinsic-size: 10px 667px;
      }
    </style>
    <noscript>
      <style>
        body main section + section {
          contain-intrinsic-size: unset;
          content-visibility: unset;
        }
      </style>
    </noscript>
  </head>
  <body class="bg-subtle-grunge connection--unknown leading-normal text-gray-900">
    <script>
      document.querySelector('html').classList.remove('no-js');
      document.querySelector('html').classList.add('js');

      if (navigator.connection && navigator.connection.effectiveType) {
        document.body.classList.remove('connection--unknown');
        document.body.classList.add(`connection--${navigator.connection.effectiveType}`);
      }
    </script>
    <script>
      let root = document.documentElement;
      let scrollbarWidth = window.innerWidth - document.body.offsetWidth;
      root.style.setProperty('--scrollbar-width', `${scrollbarWidth}px`);
    </script>
    <a
      href="#content"
      class="bg-binding-dark sr-only left-3 top-3 z-50 block border border-yellow-500 p-5 text-yellow-500 focus:not-sr-only"
      >Skip to main content</a
    >
    <div role="document" class="flex min-h-screen flex-col">
      {% include "header.njk" %}
      <main class="bg-subtle-grunge outline-none relative w-full flex-grow" id="content" tabindex="-1">
        {% if page.url == '/' %} {% include "homepage/homepage-header.njk" %}
        <div class="z-10 -mb-6 -mt-6 -skew-y-1 transform">
          <div class="bg-binding-dark h-12"></div>
          <div class="bg-subtle-grunge h-12"></div>
        </div>
        {% endif %}
        <div class="absolute inset-0 overflow-hidden">
          <img
            hidden
            data-frivolous-grunge
            class="absolute inline opacity-40 mix-blend-multiply"
            loading="eager"
            fetchpriority="high"
            alt=""
            width="500"
            height="451"
            src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
            srcset="
              https://wolstenhol.me/proxy/cloudinary/image/upload/c_scale,q_10,w_500,fl_progressive/v1614122419/one-offs/cup-coffee-stain-2.jpg  1x,
              https://wolstenhol.me/proxy/cloudinary/image/upload/c_scale,q_10,w_1000,fl_progressive/v1614122419/one-offs/cup-coffee-stain-2.jpg 2x
            "
            style="left: -230px; top: 600px"
          />
          <img
            hidden
            data-frivolous-grunge
            class="absolute inline transform object-cover object-left opacity-40 mix-blend-multiply"
            loading="lazy"
            decoding="async"
            alt=""
            width="112"
            height="405"
            src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
            srcset="
              https://wolstenhol.me/proxy/cloudinary/image/upload/c_scale,q_10,w_500,fl_progressive/v1614122419/one-offs/cup-coffee-stain-2.jpg  1x,
              https://wolstenhol.me/proxy/cloudinary/image/upload/c_scale,q_10,w_1000,fl_progressive/v1614122419/one-offs/cup-coffee-stain-2.jpg 2x
            "
            style="right: 0; top: 1900px; height: 405px; width: 9%"
          />
          <img
            hidden
            data-frivolous-grunge
            class="absolute inline -rotate-45 transform opacity-40 mix-blend-multiply"
            loading="lazy"
            decoding="async"
            alt=""
            width="500"
            height="451"
            src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
            srcset="
              https://wolstenhol.me/proxy/cloudinary/image/upload/c_scale,q_10,w_500,fl_progressive/v1614122419/one-offs/cup-coffee-stain-2.jpg  1x,
              https://wolstenhol.me/proxy/cloudinary/image/upload/c_scale,q_10,w_1000,fl_progressive/v1614122419/one-offs/cup-coffee-stain-2.jpg 2x
            "
            style="left: -230px; top: 2900px"
          />
        </div>
        <div class="section__inner mx-auto py-10 lg:pb-28">
          <div class="transform">
            {{ content | safe }}
          </div>
        </div>
        {% if (page.filePathStem == '/work') %}
        <div
          class="sticky left-0 bottom-0 hidden p-5 xl:inline-block"
          x-data="{ show: false }"
          x-on:scroll.window.debounce.passive.once="show=true"
        >
          <a x-show="show" x-transition.opacity class="highlight px-4 py-2 font-bold underline" href="#content" style="display: none"
            >Back to top</a
          >
        </div>
        {% endif %}
      </main>
      <dialog id="pwa-update-dialog" x-data class="w-11/12 max-w-3xl transform select-none bg-black p-4 text-white shadow-2xl">
        <button
          type="button"
          class="absolute right-3 top-3 rounded-bl-lg bg-black px-3 py-2 text-lg font-bold text-white"
          x-on:click="$root.close();"
        >
          <span class="sr-only">Close</span>
          <svg
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon"
          >
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
        <form method="dialog" class="bg-binding-dark p-4 pr-14 leading-snug xl:p-8">
          <div class="space-y-3">
            <h2 class="font-serif text-2xl font-bold">Updated content available!</h2>
            <p id="service-worker-update-desc" class="text-xl font-bold">
              If you're not in the middle of anything, click 'Update now' to reload the page with the newest content.
            </p>
            <p>If you don't update now and you have not interacted with my contact form then the page will refresh when you change tabs.</p>
          </div>
          <div class="mt-5 flex gap-3">
            <button
              aria-describedby="service-worker-update-desc"
              autofocus
              value="refresh"
              type="submit"
              class="flex select-none items-center space-x-2 rounded border-2 border-black bg-yellow-300 px-4 py-2 font-bold text-black shadow-hard hocus:bg-yellow-400"
            >
              Update now to see the newer content
            </button>
          </div>
        </form>
      </dialog>
      {% include "footer.njk" %}
    </div>
    <div hidden>{% include "src/assets/sprite.svg" %} {% include "src/assets/design-elements.svg" %}</div>
    <script type="module">
      // https://infrequently.org/2020/12/resize-resilient-deferred-rendering/
      let eqIsh = (a, b, fuzz = 2) => {
        return Math.abs(a - b) <= fuzz;
      };

      let rectNotEQ = (a, b) => {
        return !eqIsh(a.width, b.width) || !eqIsh(a.height, b.height);
      };

      let spaced = new WeakMap();

      let reserveSpace = (el, rect = el.getClientBoundingRect()) => {
        let old = spaced.get(el);
        if (!old || rectNotEQ(old, rect)) {
          spaced.set(el, rect);
          el.style.setProperty('contain-intrinsic-size', `${rect.width}px ${rect.height}px`);
        }
      };

      let iObs = new IntersectionObserver(
        (entries, o) => {
          entries.forEach(entry => {
            reserveSpace(entry.target, entry.boundingClientRect);
          });
        },
        { rootMargin: '500px 0px 500px 0px' }
      );

      let rObs = new ResizeObserver((entries, o) => {
        entries.forEach(entry => {
          reserveSpace(entry.target, entry.contentRect);
        });
      });

      let sections = document.querySelectorAll('body main section');

      sections.forEach(el => {
        iObs.observe(el);
        rObs.observe(el);
      });

      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          sections[0].style.setProperty('contain-intrinsic-size', 'auto');
        });
      });
    </script>
    <script type="module" src="/assets/scripts/global.js"></script>

    {% if (page.url == '/') %}
    <script type="module" src="/assets/scripts/homepage.js"></script>
    {% endif %} {% if (page.filePathStem == '/github-stars') %}
    <script type="module" src="/assets/scripts/github-stars.js"></script>
    {% endif %} {% if (page.filePathStem == '/contact') %}
    <script type="module" src="/assets/scripts/contact.js"></script>
    {% endif %} {% if (page.filePathStem == '/404') %}
    <script type="module" src="/assets/scripts/404.js"></script>
    {% endif %} {% if (page.filePathStem == '/work') %}
    <script type="module" src="/assets/scripts/work.js"></script>
    {% endif %}

    <script>
      if (
        document.location.hash.includes('access_token') &&
        document.location.hash.includes('token_type') &&
        document.location.hash.includes('expires_in') &&
        document.location.hash.includes('refresh_token')
      ) {
        const redirectUrl = 'https://wolstenhol.me/submit-reading-item';
        window.location = redirectUrl + document.location.hash;
      }
    </script>
    <!-- LAST BUILD: {{ build.env}} {{ build.timestamp | dateToISO }} -->
    {% if build.env == 'production' %}
    <script
      defer
      src="https://static.cloudflareinsights.com/beacon.min.js"
      data-cf-beacon='{"token": "7210db6185e14990ba2dc29243b3e1ef"}'
    ></script>
    {% endif %}
  </body>
</html>
